/**
 * Util
 * @copyright (c) 2020 Six
 * @license https://github.com/sixcious/shr/blob/main/LICENSE
 */
class Util{static throttle(t,e){let i,r=0;return function n(...a){const s=Date.now(),o=s-r;clearTimeout(i),o>=e?(t.apply(null,a),r=s):i=setTimeout(n.bind(null,...a),e-o)}}static clone(t,e="structuredClone",i=!0){let r;try{if("json"===e)r=JSON.parse(JSON.stringify(t));else r=structuredClone(t)}catch(r){const n="structuredClone"===e?"json":"structuredClone";if(i)return Util.clone(t,n,!1)}return r}static isValidURL(t,e="default",i={}){let r=!1;const n=["about:","javascript:","mailto:"];try{const i=new URL(t);if("next-link"===e)r=i&&i.href&&i.href!==window.location.href&&i.hostname===window.location.hostname;else r=!!i.href&&!n.includes(i.protocol)}catch(t){i.error=t.message}return r}static isValidExtension(t,e="default"){let i=!1;const r=Util.findExtension(Util.findFilenameAndExtension(t)).toLowerCase(),n=["jpg","jpeg","png","gif","svg","webp","avif","jxl"],a=["otf","ttf","woff","woff2"],s=["css","ico","js","json","txt","xml"];try{switch(e){case"next-link":i=!s.concat(n).concat(a).includes(r);break;case"list":i=!s.concat(a).includes(r);break;case"image":i=n.includes(r);break;case"download":i=r&&r.trim().length>0&&/^[a-z0-9\\.]+$/i.test(r)&&r.length<=8}}catch(t){}return i}static findFilenameAndExtension(t){let e="";return t&&(e=t.split("#").shift().split("?").shift().split("/").pop()),e}static findFilename(t){let e="";return t&&(e=t.split(".").shift()),e}static findExtension(t){let e="";return t&&t.includes(".")&&(e=t.split(".").pop()),e}static fixURL(t){try{const e=new URL(t);("http:"===e.protocol&&"https:"===window.location.protocol||"http:"===window.location.protocol&&"https:"===e.protocol)&&(t=t.replace(e.protocol,window.location.protocol)),(e.hostname.startsWith("www.")&&e.hostname.replace("www.","")===window.location.hostname||window.location.hostname.startsWith("www.")&&window.location.hostname.replace("www.","")===e.hostname)&&(t=t.replace(e.hostname,window.location.hostname))}catch(t){}return t}static wildcardToRegularExpression(t){return new RegExp("^"+t.split(/\*+/).map(Util.escapeRegularExpression).join(".*")+"$")}static escapeRegularExpression(t){return t.replace(/[.*+^$?|\\{}()[\]]/g,"\\$&")}static processStyle(t){return t.replaceAll(";"," !important;")}static getTotalHeight(t){const e=t?.documentElement,i=t?.body;return Math.max(e?.clientHeight,e?.scrollHeight,e?.offsetHeight,i?.clientHeight,i?.scrollHeight,i?.offsetHeight)}static createIcon(t,e={color:"#000000"}){let i;const r={infinity:{viewBox:"0 0 100 100",width:"33",height:"33",stroked:!0,strokeWidth:"15",strokeLinecap:"round",pathStyle:"transform:scale(0.77); transform-origin:50px 50px;",path:"M24.3 30C11.4 30 5 43.3 5 50s6.4 20 19.3 20c19.3 0 32.1-40 51.4-40 C88.6 30 95 43.3 95 50s-6.4 20-19.3 20C56.4 70 43.6 30 24.3 30z",style:""},"angle-down":{viewBox:"0 0 384 512",width:"20",height:"20",path:"M192 384c-8.188 0-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L192 306.8l137.4-137.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-160 160C208.4 380.9 200.2 384 192 384z",style:"cursor: pointer; margin-left: 16px;"},"angle-up":{viewBox:"0 0 384 512",width:"20",height:"20",path:"M352 352c-8.188 0-16.38-3.125-22.62-9.375L192 205.3l-137.4 137.4c-12.5 12.5-32.75 12.5-45.25 0s-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0l160 160c12.5 12.5 12.5 32.75 0 45.25C368.4 348.9 360.2 352 352 352z",style:"cursor: pointer; margin-right: 16px;"},"angles-down":{viewBox:"0 0 384 512",width:"20",height:"20",path:"M169.4 278.6C175.6 284.9 183.8 288 192 288s16.38-3.125 22.62-9.375l160-160c12.5-12.5 12.5-32.75 0-45.25s-32.75-12.5-45.25 0L192 210.8L54.63 73.38c-12.5-12.5-32.75-12.5-45.25 0s-12.5 32.75 0 45.25L169.4 278.6zM329.4 265.4L192 402.8L54.63 265.4c-12.5-12.5-32.75-12.5-45.25 0s-12.5 32.75 0 45.25l160 160C175.6 476.9 183.8 480 192 480s16.38-3.125 22.62-9.375l160-160c12.5-12.5 12.5-32.75 0-45.25S341.9 252.9 329.4 265.4z",style:"cursor: pointer; margin-left: 16px;"},"angles-up":{viewBox:"0 0 384 512",width:"20",height:"20",path:"M54.63 246.6L192 109.3l137.4 137.4C335.6 252.9 343.8 256 352 256s16.38-3.125 22.62-9.375c12.5-12.5 12.5-32.75 0-45.25l-160-160c-12.5-12.5-32.75-12.5-45.25 0l-160 160c-12.5 12.5-12.5 32.75 0 45.25S42.13 259.1 54.63 246.6zM214.6 233.4c-12.5-12.5-32.75-12.5-45.25 0l-160 160c-12.5 12.5-12.5 32.75 0 45.25s32.75 12.5 45.25 0L192 301.3l137.4 137.4C335.6 444.9 343.8 448 352 448s16.38-3.125 22.62-9.375c12.5-12.5 12.5-32.75 0-45.25L214.6 233.4z",style:"cursor: pointer; margin-right: 16px;"},"circle-pause":{viewBox:"0 0 512 512",width:"40",height:"40",path:"M256 0C114.6 0 0 114.6 0 256s114.6 256 256 256s256-114.6 256-256S397.4 0 256 0zM224 191.1v128C224 337.7 209.7 352 192 352S160 337.7 160 320V191.1C160 174.3 174.3 160 191.1 160S224 174.3 224 191.1zM352 191.1v128C352 337.7 337.7 352 320 352S288 337.7 288 320V191.1C288 174.3 302.3 160 319.1 160S352 174.3 352 191.1z",title:Util.i18nGetMessage("auto_pause_button_title")},"circle-play":{viewBox:"0 0 512 512",width:"40",height:"40",path:"M512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256zM176 168V344C176 352.7 180.7 360.7 188.3 364.9C195.8 369.2 205.1 369 212.5 364.5L356.5 276.5C363.6 272.1 368 264.4 368 256C368 247.6 363.6 239.9 356.5 235.5L212.5 147.5C205.1 142.1 195.8 142.8 188.3 147.1C180.7 151.3 176 159.3 176 168V168z",title:Util.i18nGetMessage("auto_resume_button_title")},"circle-xmark":{viewBox:"0 0 512 512",width:"20",height:"20",path:"M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM175 208.1L222.1 255.1L175 303C165.7 312.4 165.7 327.6 175 336.1C184.4 346.3 199.6 346.3 208.1 336.1L255.1 289.9L303 336.1C312.4 346.3 327.6 346.3 336.1 336.1C346.3 327.6 346.3 312.4 336.1 303L289.9 255.1L336.1 208.1C346.3 199.6 346.3 184.4 336.1 175C327.6 165.7 312.4 165.7 303 175L255.1 222.1L208.1 175C199.6 165.7 184.4 165.7 175 175C165.7 184.4 165.7 199.6 175 208.1V208.1z",style:(e.message?"position: absolute;":"position: fixed;")+" cursor: pointer; top: 4px; right: 4px; padding: 2px;",title:Util.i18nGetMessage("close")},clone:{viewBox:"0 0 512 512",width:"20",height:"20",path:"M64 464H288C296.8 464 304 456.8 304 448V384H352V448C352 483.3 323.3 512 288 512H64C28.65 512 0 483.3 0 448V224C0 188.7 28.65 160 64 160H128V208H64C55.16 208 48 215.2 48 224V448C48 456.8 55.16 464 64 464zM160 64C160 28.65 188.7 0 224 0H448C483.3 0 512 28.65 512 64V288C512 323.3 483.3 352 448 352H224C188.7 352 160 323.3 160 288V64zM224 304H448C456.8 304 464 296.8 464 288V64C464 55.16 456.8 48 448 48H224C215.2 48 208 55.16 208 64V288C208 296.8 215.2 304 224 304z",style:(e.message?"position: absolute;":"position: fixed;")+" cursor: pointer; top: 4px; right: 24px; padding: 2px; transform: rotate(180deg);",title:Util.i18nGetMessage("move-button-tooltip")},xmark:{viewBox:"0 0 320 512",width:"20",height:"20",path:"M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z",style:(e.message?"position: absolute;":"position: fixed;")+" cursor: pointer; top: 4px; right: 4px; padding: 2px;",title:Util.i18nGetMessage("close")}}[t];try{const t="http://www.w3.org/2000/svg";i=document.createElementNS(t,"svg"),i.setAttribute("width",e.size||e.width||r.width),i.setAttribute("height",e.size||e.height||r.height),i.setAttribute("viewBox",r.viewBox),i.setAttribute("preserveAspectRatio","xMidYMid"),i.setAttribute("style",Util.processStyle("display: inline; position: initial; margin: auto; shape-rendering: auto; vertical-align: middle; visibility: visible; width: initial; height: initial; transform: none; transition: none; "+(e.style||r.style)));const n=document.createElementNS(t,"path");if(n.setAttribute("style",Util.processStyle("fill: "+e.color+";")),n.setAttribute("d",r.path),r.stroked&&(n.setAttribute("stroke-width",r.strokeWidth),n.setAttribute("stroke-linecap",r.strokeLinecap),n.setAttribute("style",Util.processStyle(r.pathStyle+" stroke: "+e.color+"; fill: none;"))),e.animated){n.setAttribute("stroke-dasharray","205.271142578125 51.317785644531256");const e=document.createElementNS(t,"animate");e.setAttribute("attributeName","stroke-dashoffset"),e.setAttribute("repeatCount","indefinite"),e.setAttribute("dur","2s"),e.setAttribute("keyTimes","0;1"),e.setAttribute("values","0;256.58892822265625"),n.appendChild(e)}if(r.title){const e=document.createElementNS(t,"title");e.textContent=r.title,i.appendChild(e)}i.appendChild(n)}catch(t){i=document.createTextNode(" ")}return i}static triggerCustomEvent(t,e,i,r=!0,n){try{if(r){const r={detail:void 0,bubbles:!0,cancelable:!1};"firefox"===n&&"function"==typeof cloneInto?r.detail=cloneInto(JSON.parse(JSON.stringify(i)),document.defaultView):r.detail=JSON.parse(JSON.stringify(i));const a=new CustomEvent(t,r);e.dispatchEvent(a)}}catch(t){}}static async downloadBackup(t=!0){await Promisify.storageSet({backupDate:(new Date).toJSON()});const e=await Promisify.storageGet(void 0,void 0,["databaseAP","databaseIS"]),i=JSON.stringify(e,null,"  "),r=(new Date).toJSON(),n=document.createElement("a"),a=URL.createObjectURL(new Blob([i],{type:"text/plain"}));n.href=a,n.download=(Util.i18nGetMessage("name")+" Backup "+(r||"")).replaceAll(/[\s.:]/g,"_")+".json",n.dispatchEvent(new MouseEvent("click")),setTimeout((function(){URL.revokeObjectURL(a)}),5e3),t&&MDC.openSnackbar(Util.i18nGetMessage("backup_data_success_snackbar"))}static highlightElement(t,e){try{e&&"undefined"!=typeof HoverBox&&(new HoverBox).highlightElement(t,!0)}catch(t){}}static isDateWithinPastDays(t,e=1){let i=!1;try{const r=new Date,n=new Date(t);n instanceof Date&&!isNaN(n)&&r-n<864e5*e&&r-n>0&&(i=!0)}catch(t){}return i}static getBrowserName(){const t="chrome",e="edge",i="firefox",r="undefined"!=typeof chrome&&chrome&&chrome.runtime&&chrome.runtime.id?chrome.runtime.id:"";let n="undefined"!=typeof V?r===V.ID_CHROME?t:r===V.ID_EDGE?e:r===V.ID_FIREFOX?i:"":"",a="chrome.runtime.id:"+r;if(!n){const r="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"";n=r.includes("Firefox/")?i:r.includes("Edg/")?e:t,a="navigator.userAgent:"+r}return n}static getPlatformName(){const t="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"";return/Android|iPad|iPhone|iPod|Kindle|Opera Mini|webOS|Windows Phone/i.test(t)?"mobile":"desktop"}static i18nGetMessage(t,...e){if(!t)return"UNDEFINED_i18n_KEY";t=t.replaceAll("-","_");let i=V.messages[t]?.message||("undefined"!=typeof chrome&&chrome.i18n?.getMessage?chrome.i18n.getMessage(t):"");if(e)for(const t of e)i=i.replaceAll("{{"+t[0]+"}}",t[1]);return i}static async loadMessages(t="en"){t||(t="en");let e={};try{const i=chrome.runtime.getURL(("en"===t?"/_locales/":"/-locales/")+t+"/messages.json"),r=await fetch(i);e=await r.json(),document.documentElement.lang=t}catch(t){}return e}static animateNumber(t,e,i=0,r=800,n=""){const a=Intl.NumberFormat("en",{notation:"compact"});let s=null;window.requestAnimationFrame((function o(c){s||(s=c);const l=Math.min((c-s)/r,1),p=Math.floor(l*(e-i)+i);t.textContent=(p<999e12?a.format(p):"1Q+")+n,l<1&&window.requestAnimationFrame(o)}))}static calculateElementsPercentageDifference(t,e,i){let r,n=0,a="innerHTML";try{a=i||Math.min(t.innerText?.length,e.innerText?.length)>=1e3?"innerText":"innerHTML";const r=t[a]?.substring(0,1e4),s=e[a]?.substring(0,1e4),o="undefined"!=typeof Levenshtein?Levenshtein.distance(r,s):1,c=Math.max(r?.length,s?.length)||1;n=("number"==typeof o?o:c)/c*100}catch(t){r=t?.message}return{percentageDiff:n,propertyDiff:a,error:r}}static async y(t){let e=!1;try{Util.isEmptyObject(t)&&(t=await Promisify.storageGet()),V.KEYS.some((e=>Object.hasOwn(t,e)))&&(e=!!(Util.isDateWithinPastDays(t[V.KEYS[2]],1)&&t[V.KEYS[0]]&&t[V.KEYS[1]])||("undefined"!=typeof X?await Util.z():await Promisify.runtimeSendMessage({sender:"util",receiver:"background",greeting:"z"}))),t[V.KEYS[0]]=e}catch(t){}return e}static async z(){let t=!1;const e=await Promisify.storageGet();try{const i=e[V.KEYS[1]],r=i.length/2,n=await Cryptography.hash(i.substring(0,r),i.substring(r));t=X.HASHES.includes(n)}catch(t){}if(t){const t={};V.KEYS.forEach((i=>{t[i]=e[i]})),t[V.KEYS[0]]=!0,t[V.KEYS[2]]=(new Date).toJSON(),await Promisify.storageSet(t)}else await Promisify.storageRemove(V.KEYS);return t}static debug(){const t={};for(const e of Object.keys(V))t[e]=V[e];return t}static isEmptyObject(t){return!t||"object"!=typeof t||Object.keys(t).length<=0}static isEmptyArray(t){return!t||!Array.isArray(t)||t.length<=0}static uniqifyArray(t,e,i=!1){return i?t.filter(((t,i,r)=>r.findIndex((i=>t[e]===i[e]))===i)):[...new Map(t.map((t=>[t[e],t]))).values()]}static arrayDifference(t,e,i){return t.filter((t=>!e.some((e=>t[i]===e[i]))))}static arrayMinMaxProperty(t,e,i="max"){const r="max"===i,n=Util.isEmptyArray(t)?[]:t.filter((t=>t&&t[e]));return Util.isEmptyArray(n)?{}:n.reduce((function(t,i){return(r?t[e]>i[e]:t[e]<i[e])?t:i}))}static arrayMostFrequent(t){return t.reduce(((t,e,i)=>((i=t.map.get(e))&&++i.count||t.map.set(e,i={item:e,count:1}),t.max.count<i.count&&(t.max=i),t)),{map:new Map,max:{item:null,count:0}}).max}static updateETA(t,e,i){const r=~~(t/3600),n=~~(t%3600/60),a=Math.floor(t%60),s=(r+"").padStart(2,"0")+Util.i18nGetMessage("eta_hour"),o=(n+"").padStart(2,"0")+Util.i18nGetMessage("eta_minute"),c=(a+"").padStart(2,"0")+Util.i18nGetMessage("eta_second");e.textContent=t<=0||!r&&!n&&!a?i?Util.i18nGetMessage("eta_done"):Util.i18nGetMessage("eta_tbd"):t>86400?Util.i18nGetMessage("eta_day"):s+o+c}static safeFilename(t){let e=t?.replace(/([\/\\\?\%\*\:\|\"\<\>])/gi,"_");return e="firefox"===V.items?.browserName?e?.substring(0,209):e,e}static safeFolderName(t){let e=t?.replace(/([\/\\\?\%\*\:\|\"\<\>\.])/gi,"_");return e="firefox"===V.items?.browserName?e?.substring(0,209):e,e}static async injectContentScripts(t){const e=[];for(const i of chrome.runtime.getManifest().content_scripts||[])for(const r of await chrome.tabs.query({url:i.matches}))if(!(t&&t!==r.id||Util.isProtectedBrowserPage(r.url)))try{if(!await Util.isScriptInjected(r.id,i.all_frames)&&(await chrome.scripting.executeScript({files:i.js,target:{tabId:r.id,allFrames:i.all_frames},injectImmediately:"document_start"===i.run_at,world:i.world}),chrome.runtime.lastError))throw new Error(chrome.runtime.lastError)}catch(t){e.push(t)}return e}static async isScriptInjected(t,e){let i;try{i=(await chrome.scripting.executeScript({target:{tabId:t,allFrames:!!e},func:e?()=>"function"==typeof Download:()=>"function"==typeof Content}))[0].result}catch(t){}return i}static isProtectedBrowserPage(t){let e=!1;try{const i=new URL(t);e=["about:","chrome:","chrome-extension:","edge:","extension:","kiwi:","kiwi-extension:","moz-extension:"].includes(i.protocol)}catch(t){}return e}static isStorePage(t){let e=!1;try{const i=new URL(t),r=V.items.browserName;e="firefox"===r&&"addons.mozilla.org"===i.hostname||"edge"===r&&"microsoftedge.microsoft.com"===i.hostname||"chrome"===r&&"chromewebstore.google.com"===i.hostname}catch(t){}return e}static isErrorPage(t){let e=!1;try{if(!Util.isEmptyArray(t)&&"object"==typeof t[0]&&"string"==typeof t[0].message){const i=t[0].message.toLowerCase();e=i.includes("error page")||i.includes("host permission")}}catch(t){}return e}static capitalize(t){return t?t.charAt(0).toUpperCase()+t.substring(1):""}static getPreferredColor(){let t="light";return"undefined"!=typeof window&&window.matchMedia&&(t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),t}static async getTabs(t){const e=await chrome.tabs.query({});return t?e.filter((e=>e.windowId===t)):e}static async getCurrentTab(){const t=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return Util.isEmptyArray(t)?void 0:t[0]}static async createObjectURL(t,e){const i=await(await fetch(t,{credentials:"same-origin"})).blob(),r=URL.createObjectURL(i);return"number"==typeof e&&setTimeout((()=>{URL.revokeObjectURL(r)}),e),r}static runtimeSendMessageOrBackground(t){if("function"==typeof Background&&"function"==typeof Background[t.greeting])switch(t.greeting){case"setBadge":Background.setBadge(V.instance.tabId,t.badge,t.temporary,t.text);break;case"addTabUpdatedListener":Background.addTabUpdatedListener();break;case"executeToolkit":Background.executeToolkit(t.instance)}else Promisify.runtimeSendMessage(t)}static async tabsOrRuntimeSendMessage(t,e=!0){let i;try{if(t.async=!0,i=await chrome.tabs.sendMessage(V.tab.id,t),!i&&"url-incrementer"===V.APP)throw new Error("The result is undefined (is this a protected browser page?)")}catch(r){if(e&&"url-incrementer"===V.APP){switch(V.checks.blockedPage=!0,t.receiver="background",t.tab=t.tab||V.tab,t?.greeting){case"getInstance":t.greeting="buildInstance";break;case"setInstance":t.greeting="setInstance2"}i=await chrome.runtime.sendMessage(t)}}return i}static setUICorner(t,e,i="8px"){switch(e){default:case"top-right":t.style.setProperty("top",i,"important"),t.style.setProperty("bottom","","important"),t.style.setProperty("right",i,"important"),t.style.setProperty("left","","important");break;case"bottom-right":t.style.setProperty("top","","important"),t.style.setProperty("bottom",i,"important"),t.style.setProperty("right",i,"important"),t.style.setProperty("left","","important");break;case"bottom-left":t.style.setProperty("top","","important"),t.style.setProperty("bottom",i,"important"),t.style.setProperty("right","","important"),t.style.setProperty("left",i,"important");break;case"top-left":t.style.setProperty("top",i,"important"),t.style.setProperty("bottom","","important"),t.style.setProperty("right","","important"),t.style.setProperty("left",i,"important")}}static getDocumentType(t){return"infy-scroll"!==V.APP||"element"===t.append&&"click"===t.action||"none"===t.append||"ajax"===t.append&&"native"===t.ajaxMode?"top":"iframe"===t.append||"ajax"===t.append&&"native"!==t.ajaxMode||"element"===t.append&&t.pageElementIframe?"iframe":"current"}static getDocumentBasedOnType(t){if("infy-scroll"!==V.APP)return document;let e;if("click"===t)e="iframe"===V.instance.documentType?V.iframe?.contentDocument:document;else e="iframe"!==V.instance.documentType||"element"===V.instance.append&&"trim"===V.instance.pageElementIframe||!V.iframe?.contentDocument?V.currentDocument||document:V.iframe.contentDocument;return e}static decodeURLHelper(t){try{t=t&&"string"==typeof t?decodeURIComponent(t):t}catch(t){}return t}}